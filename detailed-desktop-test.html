<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电脑端返回功能详细测试</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .debug-info {
            background-color: #eee;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        .highlight {
            background-color: #fff9c4;
            padding: 2px 4px;
        }
    </style>
</head>
<body>
    <h1>电脑端返回功能详细测试</h1>
    
    <div class="test-container">
        <h2>测试1: 直接访问功能1电脑端页面</h2>
        <p>点击下方按钮访问功能1电脑端页面，然后使用返回按钮返回</p>
        <button id="goto-feature1-desktop">访问功能1电脑端页面</button>
    </div>
    
    <div class="test-container">
        <h2>测试2: 模拟功能1电脑端页面的返回逻辑</h2>
        <p>这个测试会直接在当前页面执行返回逻辑，不进行实际跳转</p>
        <button id="simulate-return">模拟返回按钮点击</button>
    </div>
    
    <div class="test-container">
        <h2>测试3: 强制设置desktop=true参数返回主页</h2>
        <p>这个按钮会强制使用desktop=true参数返回主页</p>
        <button id="force-desktop-return">强制电脑端返回</button>
    </div>
    
    <div class="test-container">
        <h2>当前页面信息</h2>
        <p>URL: <span id="current-url" class="highlight"></span></p>
        <p>URL包含'desktop': <span id="has-desktop" class="highlight"></span></p>
        <p>URL包含'mobile': <span id="has-mobile" class="highlight"></span></p>
        <p>URL包含'feature': <span id="has-feature" class="highlight"></span></p>
    </div>
    
    <div class="test-container">
        <h2>调试日志</h2>
        <div id="debug-log" class="debug-info"></div>
    </div>

    <script>
        // 初始化页面信息
        document.addEventListener('DOMContentLoaded', function() {
            updatePageInfo();
            
            // 按钮点击事件
            document.getElementById('goto-feature1-desktop').addEventListener('click', function() {
                log('跳转到 feature1-desktop.html');
                window.location.href = 'feature1-desktop.html';
            });
            
            document.getElementById('simulate-return').addEventListener('click', function() {
                simulateReturnLogic();
            });
            
            document.getElementById('force-desktop-return').addEventListener('click', function() {
                log('强制跳转到 index.html?desktop=true');
                window.location.href = 'index.html?desktop=true';
            });
        });
        
        // 更新页面信息显示
        function updatePageInfo() {
            const currentUrl = window.location.href;
            const urlLower = currentUrl.toLowerCase();
            
            document.getElementById('current-url').textContent = currentUrl;
            document.getElementById('has-desktop').textContent = urlLower.includes('desktop').toString();
            document.getElementById('has-mobile').textContent = urlLower.includes('mobile').toString();
            document.getElementById('has-feature').textContent = urlLower.includes('feature').toString();
        }
        
        // 模拟返回按钮逻辑
        function simulateReturnLogic() {
            log('=== 开始模拟返回按钮逻辑 ===');
            
            const currentUrl = window.location.href.toLowerCase();
            log('当前URL(小写): ' + currentUrl);
            
            // 模拟feature-script.js中的检测逻辑
            const hasDesktopInUrl = currentUrl.includes('desktop');
            const isNotMobilePage = !currentUrl.includes('mobile');
            const isLikelyDesktop = hasDesktopInUrl || (isNotMobilePage && currentUrl.includes('feature'));
            
            log('检测结果:');
            log('  hasDesktopInUrl: ' + hasDesktopInUrl);
            log('  isNotMobilePage: ' + isNotMobilePage);
            log('  isLikelyDesktop: ' + isLikelyDesktop);
            
            const targetUrl = isLikelyDesktop ? 'index.html?desktop=true' : 'index.html?mobile=true';
            log('根据检测结果，应该跳转到: ' + targetUrl);
            
            // 额外的URL解析测试
            log('\n=== 额外的URL解析测试 ===');
            
            // 测试从功能1电脑端页面的URL
            const testFeature1DesktopUrl = 'http://example.com/feature1-desktop.html';
            const testFeature1DesktopUrlLower = testFeature1DesktopUrl.toLowerCase();
            log('测试URL: ' + testFeature1DesktopUrl);
            log('  hasDesktopInUrl: ' + testFeature1DesktopUrlLower.includes('desktop'));
            log('  isNotMobilePage: ' + !testFeature1DesktopUrlLower.includes('mobile'));
            log('  isLikelyDesktop: ' + (testFeature1DesktopUrlLower.includes('desktop') || (!testFeature1DesktopUrlLower.includes('mobile') && testFeature1DesktopUrlLower.includes('feature'))));
            
            log('=== 模拟返回按钮逻辑结束 ===');
        }
        
        // 日志函数
        function log(message) {
            const logElement = document.getElementById('debug-log');
            logElement.textContent += message + '\n';
            logElement.scrollTop = logElement.scrollHeight; // 自动滚动到底部
            console.log(message); // 同时输出到控制台
        }
    </script>
</body>
</html>